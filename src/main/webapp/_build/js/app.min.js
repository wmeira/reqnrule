angular.module("reqnrule",["ngRoute","ngCookies","ui.bootstrap"]).constant("SERVER_CONFIG",{URI:"http://localhost:8080/reqnrule",PAPEL:{GERENTE_DE_PROJETO:"Gerente de projeto",GERENTE_DE_REQUISITOS:"Gerente de requisitos",VERIFICADOR:"Verificador",OBSERVADOR:"Observador",EXCLUIDO:"Excluído"},TIPO_REQUISITO:{REQUISITO_FUNCIONAL:"Requisito Funcional",REQUISITO_NAO_FUNCIONAL:"Requisito Não-Funcional",REQUISITO_DE_PROJETO:"Requisito de Projeto"},PRIORIDADE:{ESSENCIAL:"Essencial",DESEJADO:"Desejado",OPCIONAL:"Opcional"},ESTADO_REQUISITO:{ESPECIFICADO:"Especificado",APROVADO:"Aprovado",IMPLEMENTADO:"Implementado",VALIDADO:"Validado",CANCELADO:"Cancelado"},ESTADO_SOLICITACA:{SOLICITADO:"Solicitado",ATENDIDO:"Atendido",REJEITADO:"Rejeitado"}}).config(["$locationProvider","$routeProvider",function(o,e){e.when("/",{templateUrl:"views/main.html"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController as loginCtrl",resolve:{loggedOn:["AuthService","$location",function(o,e){return o.session().then(function(){e.path("/usuario"),e.replace()},function(o){})}]}}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupController as signupCtrl",resolve:{loggedOn:["AuthService","$location",function(o,e){return o.session().then(function(){e.path("/usuario"),e.replace()},function(o){})}]}}).when("/usuario",{templateUrl:"views/usuario.html",controller:"UsuarioController",controllerAs:"usuarioCtrl",resolve:{loggedOn:["AuthService","$location",function(o,e){return o.session().then(function(){},function(o){e.path("/login"),e.replace()})}]}}).when("/projetos",{templateUrl:"views/lista-projetos.html",controller:"ListaProjetoController as listaProjetoCtrl",resolve:{loggedOn:["AuthService","ProjetoService","$location",function(o,e,r){return o.session().then(function(){e.getProjetos().then(function(){},function(o){"401"==o.status?(alert("Usuário não autorizado."),r.path("/login"),r.replace()):"500"==o.status?alert("Problema ao obter lista de projetos. Erro interno do servidor."):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),r.path("/"),r.replace())})},function(o){r.path("/login"),r.replace()})}]}}).when("/novo-projeto",{templateUrl:"views/novo-projeto.html",controller:"NovoProjetoController as projetoCtrl",resolve:{loggedOn:["AuthService","$location",function(o,e){return o.session().then(function(){},function(o){e.path("/login"),e.replace()})}]}}).when("/projeto/:pid",{templateUrl:"views/projeto.html",controller:"ProjetoController as projetoCtrl",resolve:{loggedOn:["AuthService","ProjetoService","$route","$location",function(o,e,r,t){return o.session().then(function(){return e.encontrarProjetoPorId(r.current.params.pid).then(function(o){},function(o){"403"==o.status?(alert("Erro: usuário não é membro do projeto."),t.path("/projetos"),t.replace()):"400"==o.status?(alert("Projeto não encontrado."),t.path("/projetos"),t.replace()):"401"==o.status?(t.path("/login"),t.replace()):"500"==o.status?alert("Problema ao obter projeto. Erro interno do servidor."):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),t.path("/"),t.replace())})},function(o){t.path("/login"),t.replace()})}]}}).when("/projeto/:pid/requisito/:rid/solicitacao-mudanca",{templateUrl:"views/soliciatacao-mudanca.html",resolve:{loggedOn:["AuthService","$location",function(o,e){return o.session().then(function(){},function(o){e.path("/login"),e.replace()})}]}}).when("/sobre",{templateUrl:"views/sobre.html"}).otherwise({redirectTo:"/"})}]),angular.module("reqnrule").controller("AlterarDonoController",["SERVER_CONFIG","$scope","$modalInstance","$location","ProjetoService","projeto",function(o,e,r,t,a,i){var n=this;n.projeto=i,e.close=function(){r.close()},e.cancel=function(){r.dismiss()},n.alterarDono=function(){var o=a.alterarDonoProjeto(n.novoDono);o.then(function(o){result={tipo:"sucesso",msg:"Dono alterado com sucesso!"},r.close(result)},function(o){"403"==o.status?(result={tipo:"erro",msg:o.data.permissao},r.close(result)):"401"==o.status?(r.dismiss(),alert("Usuário não autorizado."),t.path("/login"),t.replace()):"500"==o.status?alert("Problema ao alterar dono do projeto. Erro interno do servidor."):"0"==o.status&&(r.dismiss(),alert("Servidor inacessível. Tente mais tarde."),t.path("/"),t.replace())})},n.initGerentesDeProjeto=function(){n.gerentesDeProjeto=n.getGerentesDeProjeto()},n.getGerentesDeProjeto=function(){var o=[];for(var e in n.projeto.membros){var r=n.projeto.membros[e];"GERENTE_DE_PROJETO"==r.papel&&r.usuario.id!=n.projeto.dono.id&&o.push(r)}return o},n.getPapel=function(){return o.PAPEL[n.membro.papel]}}]),angular.module("reqnrule").controller("AtenderSolicitacaoController",["SERVER_CONFIG","$scope","$modalInstance","$location","solicitacao","membro",function(o,e,r,t,a,i){var n=this;n.solicitacao=a,n.membro=i,e.close=function(){r.close()},e.confirmar=function(){r.close()},e.cancel=function(){n.solicitacao.observacoes=null,r.dismiss()},n.atenderSolicitacao=function(){n.solicitacao.estado="ATENDIDO",r.close()},n.rejeitarSolicitacao=function(){n.solicitacao.estado="REJEITADO",r.close()},n.getDataFormatada=function(o){var e=new Date(o);return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" "+("0"+e.getDate()).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()},n.podeAtender=function(){var e=o.PAPEL[n.membro.papel];return e==o.PAPEL.GERENTE_DE_PROJETO||e==o.PAPEL.GERENTE_DE_REQUISITOS}}]),angular.module("reqnrule").controller("DeletarProjetoController",["$scope","$modalInstance","$location","ProjetoService","projeto",function(o,e,r,t,a){var i=this;i.projeto=a,o.close=function(){e.close()},o.confirmar=function(){i.deletarProjeto(),e.close()},o.cancel=function(){e.dismiss()},i.deletarProjeto=function(){var o=t.deletarProjeto(i.projeto.id);o.then(function(o){r.path("/projetos"),r.replace()},function(o){"403"==o.status?alert(o.data.permissao):"401"==o.status?(alert("Usuário não autorizado."),r.path("/login"),r.replace()):"500"==o.status?alert("Problema ao deletar projeto. Erro interno do servidor."):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),r.path("/"),r.replace())})}}]),angular.module("reqnrule").controller("DeletarRequisitoController",["SERVER_CONFIG","$scope","$modalInstance","$location","RequisitoService","ProjetoService","projeto","requisito",function(o,e,r,t,a,i,n,s){var u=this;u.projeto=n,u.requisito=s,u.getEstado=function(e){return o.ESTADO_REQUISITO[u.requisito.estado]},u.getTipo=function(e){return o.TIPO_REQUISITO[u.requisito.tipo]},u.getPrioridade=function(e){return o.PRIORIDADE[u.requisito.prioridade]},e.cancel=function(){r.dismiss()},u.deletarRequisito=function(){var o=a.deletarRequisito(u.requisito);o.then(function(){result={tipo:"sucesso",msg:"Requisito deletado com sucesso!"},r.close(result)},function(o){"403"==o.status?(result={tipo:"erro",msg:o.data.permissao},r.close(result)):"401"==o.status?(r.dismiss(),alert("Usuário não autorizado."),t.path("/login"),t.replace()):"500"==o.status?alert("Problema ao deletar requisito. Erro interno do servidor."):"0"==o.status&&(r.dismiss(),alert("Servidor inacessível. Tente mais tarde."),t.path("/"),t.replace())})}}]),angular.module("reqnrule").controller("ListaProjetoController",["SERVER_CONFIG","ProjetoService","AuthService","$location","$scope",function(o,e,r,t,a){var i=this;i.erro={},i.listaProjetos=function(){return e.listaProjetos()},i.getPapel=function(o){return userId=r.getUser().id,e.getPapel(o,userId)},i.isDono=function(o){return userId=r.getUser().id,o.dono.id==userId},i.deletarMensagem=function(){e.deletarMensagem()}}]),angular.module("reqnrule").controller("LoginController",["AuthService","$location","$scope",function(o,e,r){var t=this;t.loginInvalido="",t.login=function(){var r=o.login(t.email,t.senha);return r.then(function(r){return o.session().then(function(o){e.path("/usuario")},function(o){})},function(o){"401"==o.status?(t.loginInvalido=o.data.erro,t.clearForm()):"500"==o.status?(alert("Problema ao solicitar acesso. Erro interno do servidor."),t.clearForm()):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),e.path("/"),e.replace())})},t.clearForm=function(){t.email="",t.senha="",r.loginForm.$setPristine()}}]),angular.module("reqnrule").controller("MembroController",["SERVER_CONFIG","AuthService","$location","$scope","$modal",function(o,e,r,t,a){var i=this;i.getPapel=function(e){return o.PAPEL[e.papel]}}]),angular.module("reqnrule").controller("NovoMembroController",["$scope","$modalInstance","$location","ProjetoService","UserService","projeto",function(o,e,r,t,a,i){var n=this;n.projeto=i,n.usuario={},n.erro={},n.numeroPapel=4,n.papeis=[{valor:1,nome:"Gerente de Projeto"},{valor:2,nome:"Gerente de Requisitos"},{valor:3,nome:"Verificador"},{valor:4,nome:"Observador"}],o.close=function(){e.close()},o.cancel=function(){e.dismiss()},n.getUsuarioPorEmail=function(){n.erro={},n.procurarMembroInvalido=!0,o.searchForm.$setPristine();var t=a.encontrarPorEmail(n.searchEmail);t.then(function(o){n.isUsuarioDuplicado(o)?n.erro.procurarMembro=["Usuário já pertence ao projeto."]:(n.novoUsuario=o,n.procurarMembroInvalido=!1),n.searchEmail=""},function(o){"400"==o.status?n.erro.procurarMembro=["E-mail de usuário não cadastrado."]:"401"==o.status?(e.dismiss(),alert("Usuário não autorizado."),r.path("/login"),r.replace()):"500"==o.status?(alert("Problema ao procurar usuário. Erro interno do servidor."),n.searchEmail=""):"0"==o.status&&(e.dismiss(),alert("Servidor inacessível. Tente mais tarde."),r.path("/"),r.replace())})},n.adicionarMembro=function(){var o=t.adicionarMembro(n.projeto,n.novoUsuario,n.numeroPapel);o.then(function(o){result={tipo:"sucesso",msg:"Membro adicionado com sucesso!"},e.close(result)},function(o){"403"==o.status?(result={tipo:"erro",msg:o.data.permissao},e.close(result)):"401"==o.status?(e.dismiss(),alert("Usuário não autorizado."),r.path("/login"),r.replace()):"500"==o.status?alert("Problema ao adicionar membro. Erro interno do servidor."):"0"==o.status&&(e.dismiss(),alert("Servidor inacessível. Tente mais tarde."),r.path("/"),r.replace())})},n.isUsuarioDuplicado=function(o){for(var e in i.membros){var r=i.membros[e];if(r.usuario.id==o.id)return!0}return!1}}]),angular.module("reqnrule").controller("NovoProjetoController",["SERVER_CONFIG","ProjetoService","$location","$scope",function(o,e,r,t){var a=this;a.erro={},a.projeto={},a.novoProjetoInvalido=!1,a.novoProjeto=function(){var o=e.novoProjeto(a.projeto);o.then(function(o){alert("Projeto criado com sucesso. O usuário será redirecionado para a página do projeto para continuar o cadastro."),r.path("/projeto/"+o.id),r.replace()},function(o){a.erro={},a.novoProjetoInvalido=!0,"403"==o.status?(a.erro.nome=[o.data.nome],a.erro.descricao=[o.data.descricao]):"401"==o.status?(alert("Usuário não autorizado."),r.path("/login"),r.replace()):"500"==o.status?(alert("Problema ao criar novo projeto. Erro interno do servidor."),a.resetNovoProjetoForm()):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),r.path("/"),r.replace())})},a.resetNovoProjetoForm=function(){a.projeto={},t.novoProjetoForm.$setPristine()}}]),angular.module("reqnrule").controller("NovoRequisitoController",["SERVER_CONFIG","RequisitoService","ProjetoService","$scope","$modalInstance","$location","projeto","categorias",function(o,e,r,t,a,i,n,s){var u=this;u.projeto=n,u.categorias=s,u.prioridade=[{valor:"ESSENCIAL",nome:"Essencial"},{valor:"DESEJADO",nome:"Desejado"},{valor:"OPCIONAL",nome:"Opcional"}],u.estados=[{valor:"ESPECIFICADO",nome:"Especificado"},{valor:"APROVADO",nome:"Aprovado"},{valor:"IMPLEMENTADO",nome:"Implementado"},{valor:"VALIDADO",nome:"Validado"},{valor:"CANCELADO",nome:"Cancelado"}],u.requisito={},u.requisito.tipo="REQUISITO_FUNCIONAL",u.requisito.prioridade="ESSENCIAL",u.requisito.estado="ESPECIFICADO",u.categoriaSelect="NENHUMA",u.requisito.pai=null,u.paiSelecionado={},t.cancel=function(){u.limpaAssociacoes(),a.dismiss()},t.close=function(){u.limpaAssociacoes(),a.close()},t.confirmar=function(){u.limpaAssociacoes(),a.close()},t.uncheck=function(o){null!=u.requisito.pai&&u.requisito.pai.id==u.paiSelecionado.id?(u.requisito.pai=null,u.paiSelecionado=null):u.requisito.pai={id:u.paiSelecionado.id}},u.calcularTamanhoTabela=function(){u.projeto.requisitos.length>3?u.tamanhoTabela="151px":u.tamanhoTabela=52+33*u.projeto.requisitos.length+"px"},u.iniciarTabelaRelacionamento=function(){u.iniciarAssociacoes(),u.calcularTamanhoTabela()},u.iniciarAssociacoes=function(){u.associacoes=[];for(var o in u.projeto.requisitos){var e=u.projeto.requisitos[o];if("CANCELADO"!=e.estado&&e.id!=u.requisito.id){var r={};r.requisito=e,r.checked=!1,u.associacoes.push(r)}}},u.adicionarRequisito=function(){u.erro={},u.novoRequisitoInvalido=!1,u.ajustarCategoria(),u.setAssociacoes(),u.ajustarAssociacoes();var o=e.adicionarRequisito(u.projeto,u.requisito);o.then(function(o){result={tipo:"sucesso",msg:"Requisito adicionado com sucesso!"},a.close(result)},function(o){u.novoRequisitoInvalido=!0,"400"==o.status?(u.erro.nome=[o.data.nome],u.erro.descricao=[o.data.descricao],u.erro.categoria=[o.data.categoria],u.erro.associados=[o.data.associados]):"403"==o.status?u.erro.associados=[o.data.associados]:"401"==o.status?(a.dismiss(),alert("Usuário não autorizado."),i.path("/login"),i.replace()):"500"==o.status?alert("Problema ao adicionar novo requisito. Erro interno do servidor."):"0"==o.status&&(a.dismiss(),alert("Servidor inacessível. Tente mais tarde."),i.path("/"),i.replace())})},u.ajustarAssociacoes=function(){u.requisito.associados=[];for(var o in u.associacoes){var e=u.associacoes[o];e.checked&&u.requisito.associados.push({id:e.requisito.id})}},u.setAssociacoes=function(){u.requisito.associados=[];for(var o in u.projeto.requisitos){var e=u.projeto.requisitos[o];e.checked&&u.requisito.associados.push({id:e.id})}},u.limpaAssociacoes=function(){for(var o in u.projeto.requisitos)delete u.projeto.requisitos[o].checked},u.getEstadoRequisito=function(e){return o.ESTADO_REQUISITO[e.estado]},u.getTipoRequisito=function(e){return o.TIPO_REQUISITO[e.tipo]},u.getPrioridade=function(e){return o.PRIORIDADE[e.prioridade]},u.ajustarCategoria=function(){null!=u.categoriaInput?u.requisito.categoria=u.categoriaInput:u.requisito.categoria=u.categoriaSelect}}]),angular.module("reqnrule").controller("ProjetoController",["SERVER_CONFIG","ProjetoService","UserService","AuthService","$location","$scope","$modal",function(o,e,r,t,a,n,s){var u=this;u.erro={},u.alterarProjetoInvalido=!1,u.projeto=e.getProjetoSelecionado(),u.podeAlterarProjeto=!1,u.nomeAtual=u.projeto.nome,n.open=function(o,r,t,i){var n;switch(o){case"deletar-projeto":n=s.open({templateUrl:"views/deletar-projeto.html",controller:"DeletarProjetoController as deletarProjetoCtrl",resolve:{projeto:r}});break;case"sair-projeto":n=s.open({templateUrl:"views/sair-projeto.html",controller:"SairProjetoController as sairProjetoCtrl",resolve:{projeto:r,membro:t}});break;case"novo-membro":n=s.open({templateUrl:"views/novo-membro.html",controller:"NovoMembroController as novoMembroCtrl",resolve:{projeto:r}});break;case"editar-membro":n=s.open({templateUrl:"views/update-membro.html",controller:"UpdateMembroController as updateMembroCtrl",resolve:{membro:t}});break;case"alterar-dono":n=s.open({templateUrl:"views/alterar-dono.html",controller:"AlterarDonoController as alterarDonoCtrl",resolve:{projeto:r}});break;case"adicionar-requisito":u.getCategorias();n=s.open({templateUrl:"views/novo-requisito.html",controller:"NovoRequisitoController as novoRequisitoCtrl",size:"lg",resolve:{projeto:r,categorias:function(){var o=["NENHUMA"];for(var e in r.requisitos){var t=r.requisitos[e],a=!1;for(var i in o)if(o[i]==t.categoria){a=!0;break}a||o.push(t.categoria)}return o}}});break;case"deletar-requisito":n=s.open({templateUrl:"views/deletar-requisito.html",controller:"DeletarRequisitoController as deletarRequisitoCtrl",resolve:{projeto:r,requisito:i}});break;case"requisito":n=s.open({templateUrl:"views/requisito.html",controller:"RequisitoController as requisitoCtrl",size:"lg",resolve:{projeto:r,membro:u.getMembro(),requisito:i,categorias:function(){var o=["NENHUMA"];for(var e in r.requisitos){var t=r.requisitos[e],a=!1;for(var i in o)if(o[i]==t.categoria){a=!0;break}a||o.push(t.categoria)}return o}}})}n.result.then(function(o){u.mensagemErro=null,u.mensagemSucesso=null,null!=o&&("erro"==o.tipo?(u.mensagemErro=o.msg,u.mensagemSucesso=null):(u.mensagemSucesso=o.msg,u.mensagemErro=null))},function(){u.mensagemErro=null,u.mensagemSucesso=null})["finally"](function(){return"sair-projeto"!=o?e.encontrarProjetoPorId(u.projeto.id).then(function(){u.projeto=e.getProjetoSelecionado(),u.getRequisitosOrganizados()},function(o){"403"==o.status?(alert("Erro: usuário não é membro do projeto."),a.path("/projetos"),a.replace()):"400"==o.status?(alert("Projeto não encontrado."),a.path("/projetos"),a.replace()):"401"==o.status?(a.path("/login"),a.replace()):"500"==o.status?alert("Problema ao obter projeto. Erro interno do servidor."):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),a.path("/"),a.replace())}):void 0})},u.tab=1,u.changeTab=function(o){u.tab=o},u.tooltipSairProjeto=function(){return u.isDono()?"Para sair do projeto, transfira a posição de dono do projeto para outro Gerente de Projeto":"Ao sair do projeto não será mais possível visualizá-lo"},u.podeAlterarProjeto=function(){var r=e.getPapel(u.projeto,t.getUser().id);return r==o.PAPEL.GERENTE_DE_PROJETO},u.podeAlterarRequisito=function(){var r=e.getPapel(u.projeto,t.getUser().id);return r==o.PAPEL.GERENTE_DE_PROJETO||r==o.PAPEL.GERENTE_DE_REQUISITOS},u.alterarProjeto=function(){var o=e.alterarProjeto(u.projeto);o.then(function(o){u.alterarProjetoInvalido=!1,u.alterarProjetoValido=!0,u.nomeAtual=o.nome,n.projetoForm.$setPristine()},function(o){u.erro={},u.alterarProjetoInvalido=!0,u.alterarProjetoValido=!1,"403"==o.status?(u.erro.nome=[o.data.nome],u.erro.descricao=[o.data.descricao]):"401"==o.status?(alert("Usuário não autorizado."),a.path("/login"),a.replace()):"500"==o.status?alert("Problema ao alterar projeto. Erro interno do servidor."):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),a.path("/"),a.replace())})},u.isDono=function(){var o=t.getUser().id;return u.projeto.dono.id==o},u.getMembro=function(){var o=t.getUser().id;for(i=0;i<u.projeto.membros.length;i++){var e=u.projeto.membros[i];if(e.usuario.id==o)return e}},u.getCategorias=function(){var o=["NENHUMA"];for(var e in u.projeto.requisitos){var r=u.projeto.requisitos[e],t=!1;for(var a in o)if(o[a]==r.categoria){t=!0;break}t||o.push(r.categoria)}return o},u.getEstadoRequisito=function(e){return o.ESTADO_REQUISITO[e.estado]},u.getTipoRequisito=function(e){return o.TIPO_REQUISITO[e.tipo]},u.getPrioridade=function(e){return o.PRIORIDADE[e.prioridade]},u.organizacao=["TIPO","CATEGORIA","PRIORIDADE","ESTADO"],u.orgSelecionada="TIPO",u.getRequisitosOrganizados=function(){switch(u.orgSelecionada){case"TIPO":u.getRequisitosPorTipo();break;case"CATEGORIA":u.getRequisitosPorCategoria();break;case"PRIORIDADE":u.getRequisitosPorPrioridade();break;case"ESTADO":u.getRequisitosPorEstado()}},u.getRequisitosPorTipo=function(){var o=[{titulo:"REQUISITOS FUNCIONAIS",req:[]},{titulo:"REQUISITOS NÁO-FUNCIONAIS",req:[]},{titulo:"REQUISITOS DE PROJETO",req:[]}];for(var e in u.projeto.requisitos){var r=u.projeto.requisitos[e];"REQUISITO_FUNCIONAL"==r.tipo?o[0].req.push(r):"REQUISITO_NAO_FUNCIONAL"==r.tipo?o[1].req.push(r):"REQUISITO_DE_PROJETO"==r.tipo&&o[2].req.push(r)}u.requisitosOrganizados=o},u.getRequisitosPorCategoria=function(){var o=u.getCategorias(),e=[];for(var r in o)e.push({titulo:o[r],req:[]});for(var t in u.projeto.requisitos){var a=u.projeto.requisitos[t];for(var i in e)e[i].titulo==a.categoria&&e[i].req.push(a)}u.requisitosOrganizados=e},u.getRequisitosPorPrioridade=function(){var o=[{titulo:"ESSENCIAIS",req:[]},{titulo:"DESEJADOS",req:[]},{titulo:"OPCIONAIS",req:[]}];for(var e in u.projeto.requisitos){var r=u.projeto.requisitos[e];"ESSENCIAL"==r.prioridade?o[0].req.push(r):"DESEJADO"==r.prioridade?o[1].req.push(r):"OPCIONAL"==r.prioridade&&o[2].req.push(r)}u.requisitosOrganizados=o},u.getRequisitosPorEstado=function(){var o=[{titulo:"ESPECIFICADO",req:[]},{titulo:"APROVADO",req:[]},{titulo:"IMPLEMENTADO",req:[]},{titulo:"VALIDADO",req:[]},{titulo:"CANCELADO",req:[]}];for(var e in u.projeto.requisitos){var r=u.projeto.requisitos[e];"ESPECIFICADO"==r.estado?o[0].req.push(r):"APROVADO"==r.estado?o[1].req.push(r):"IMPLEMENTADO"==r.estado?o[2].req.push(r):"VALIDADO"==r.estado?o[3].req.push(r):"CANCELADO"==r.estado&&o[4].req.push(r)}u.requisitosOrganizados=o},u.gruposAbertos=!1,n.expandirColapsarGrupos=function(o){n.accordion.groups.map(function(e){e.isOpen=o})}}]),angular.module("reqnrule").controller("RequisitoController",["SERVER_CONFIG","ProjetoService","RequisitoService","$location","$scope","$modalInstance","$modal","projeto","membro","requisito","categorias",function(o,e,r,t,a,i,n,s,u,l,c){var d=this;d.projeto=s,d.membro=u,d.requisito=l,d.categorias=c,d.nomeAntigo=d.requisito.nome,d.categoriaSelect=d.requisito.categoria,d.estados=[{valor:"ESPECIFICADO",nome:"Especificado"},{valor:"APROVADO",nome:"Aprovado"},{valor:"IMPLEMENTADO",nome:"Implementado"},{valor:"VALIDADO",nome:"Validado"},{valor:"CANCELADO",nome:"Cancelado"}],a.close=function(){i.close()},a.confirmar=function(){i.close()},a.cancel=function(){i.dismiss()},a.uncheck=function(o){null==d.paiSelecionado&&null==o?d.paiSelecionado=d.requisito.pai:null!=d.requisito.pai&&d.requisito.pai.id==d.paiSelecionado.id?(d.requisito.pai=null,d.paiSelecionado=null):d.requisito.pai={id:d.paiSelecionado.id},a.requisitoForm.$setDirty()},a.open=function(o,e){var r;switch(o){case"solicitar-mudanca":r=n.open({templateUrl:"views/solicitacao-mudanca.html",controller:"SolicitarMudancaController as solicitarMudancaCtrl",resolve:{requisito:d.requisito}});break;case"atender-solicitacao":r=n.open({templateUrl:"views/atender-solicitacao.html",controller:"AtenderSolicitacaoController as atenderSolicitacaoCtrl",resolve:{solicitacao:e,membro:d.membro}});break;case"visualizar-solicitacao":r=n.open({templateUrl:"views/visualizar-solicitacao.html",controller:"VisualizarSolicitacaoController as visualizarSolicitacaoCtrl",resolve:{solicitacao:e}})}r.result.then(function(o){null!=o&&i.close(o),a.requisitoForm.$setDirty()})},d.iniciarTabelaRelacionamentos=function(){d.iniciarPai(),d.tamanhoTabelaRelacionamento=d.calcularTamanhoTabela(d.projeto.requisitos.length-1),d.iniciarAssociacoes()},d.iniciarTabelaSolicitacao=function(){d.solicitacoesAbertas=d.obterSolicitacoesAbertas(),d.tamanhoTabelaSolicitacao=d.calcularTamanhoTabela(d.solicitacoesAbertas.length)},d.obterSolicitacoesAbertas=function(){var o=[];for(var e in d.requisito.solicitacoesMudanca)"SOLICITADO"==d.requisito.solicitacoesMudanca[e].estado&&o.push(d.requisito.solicitacoesMudanca[e]);return o},d.iniciarTabelaHistorico=function(){d.tamanhoTabelaHistorico=d.calcularTamanhoTabela(d.requisito.mudancas.length)},d.iniciarPai=function(){var o=d.requisito.pai;if(null!=o)for(var e in d.projeto.requisitos)if(d.projeto.requisitos[e].id==o.id)return void(d.paiSelecionado=d.projeto.requisitos[e])},d.iniciarAssociacoes=function(){d.associacoes=[];for(var o in d.projeto.requisitos){var e=d.projeto.requisitos[o];if("CANCELADO"!=e.estado&&e.id!=d.requisito.id){var r={};r.requisito=e,r.checked=d.contemAssociacao(e),d.associacoes.push(r)}}},d.contemAssociacao=function(o){for(var e in d.requisito.associados)if(d.requisito.associados[e].id==o.id)return!0;return!1},d.calcularTamanhoTabela=function(o){return o>3?"151px":52+33*o+"px"},d.alterarRequisito=function(){d.erro={},d.requisitoInvalido=!1,d.ajustarCategoria(),d.ajustarAssociacoes();var o=r.alterarRequisito(d.requisito);o.then(function(o){result={tipo:"sucesso",msg:"Requisito alterado com sucesso!"},i.close(result)},function(o){d.requisitoInvalido=!0,"400"==o.status?(d.erro.nome=[o.data.nome],d.erro.descricao=[o.data.descricao],d.erro.categoria=[o.data.categoria],d.erro.associados=[o.data.associados]):"403"==o.status?d.erro.associados=[o.data.associados]:"401"==o.status?(i.dismiss(),alert("Usuário não autorizado."),t.path("/login"),t.replace()):"500"==o.status?alert("Problema ao alterar requisito. Erro interno do servidor."):"0"==o.status&&(i.dismiss(),alert("Servidor inacessível. Tente mais tarde."),t.path("/"),t.replace())})},d.podeAlterarRequisito=function(){var e=o.PAPEL[d.membro.papel];return e==o.PAPEL.GERENTE_DE_PROJETO||e==o.PAPEL.GERENTE_DE_REQUISITOS},d.podeSolicitarMudanca=function(){var e=o.PAPEL[d.membro.papel];return e==o.PAPEL.GERENTE_DE_PROJETO||e==o.PAPEL.GERENTE_DE_REQUISITOS||e==o.PAPEL.VERIFICADOR},d.getEstadoRequisito=function(e){return o.ESTADO_REQUISITO[e.estado]},d.getTipoRequisito=function(e){return o.TIPO_REQUISITO[e.tipo]},d.getPrioridade=function(e){return o.PRIORIDADE[e.prioridade]},d.limpaAssociacoes=function(){for(var o in d.projeto.requisitos)delete d.projeto.requisitos[o].checked},d.ajustarCategoria=function(){null!=d.categoriaInput?d.requisito.categoria=d.categoriaInput:d.requisito.categoria=d.categoriaSelect},d.ajustarAssociacoes=function(){d.requisito.associados=[];for(var o in d.associacoes){var e=d.associacoes[o];e.checked&&d.requisito.associados.push({id:e.requisito.id})}},d.getDataFormatada=function(o){var e=new Date(o);return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" "+("0"+e.getDate()).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()},d.cancelarAtendimento=function(o){o.estado="SOLICITADO",o.observacoes=null}}]),angular.module("reqnrule").controller("SairProjetoController",["$scope","$modalInstance","$location","ProjetoService","projeto","membro",function(o,e,r,t,a,i){var n=this;n.projeto=a,n.membro=i,o.close=function(){e.close()},o.confirmar=function(){n.sairProjeto()},o.cancel=function(){e.dismiss()},n.sairProjeto=function(){var o=t.alterarMembro(n.membro,5);o.then(function(o){r.path("/projetos"),r.replace(),e.close()},function(o){"403"==o.status?(result={tipo:"erro",msg:o.data.permissao},e.close(result)):"401"==o.status?(e.dismiss(),alert("Usuário não autorizado."),r.path("/login"),r.replace()):"500"==o.status?alert("Problema ao sair do projeto. Erro interno do servidor."):"0"==o.status&&(e.dismiss(),alert("Servidor inacessível. Tente mais tarde."),r.path("/"),r.replace())})}}]),angular.module("reqnrule").controller("SessionController",["AuthService",function(o){var e=this;e.getUser=function(){return o.getUser()},e.hasUser=function(){return o.hasUser()},e.logout=function(){return o.logout()},e.getPrimeiroNome=function(){var o=e.getUser().nome;return o.split(" ")[0]}}]),angular.module("reqnrule").controller("SignupController",["UserService","$location","$scope",function(o,e,r){var t=this;t.erro={},t.usuario={},t.signup=function(){var r=o.signup(t.usuario);r.then(function(o){e.path("/login"),alert("Conta criada com sucesso!")},function(o){t.erro={},t.signupInvalido=!0,"400"==o.status?t.erro.senha=[o.data.senha]:"403"==o.status?(t.erro.email=[o.data.email],t.erro.companhia=[o.data.companhia],t.erro.nome=[o.data.nome],t.erro.senha=[o.data.senha]):"409"==o.status?t.erro.email=[o.data.email]:"500"==o.status?(alert("Problema ao solicitar acesso. Erro interno do servidor."),t.clearForm()):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),e.path("/"),e.replace())})},t.clearForm=function(){t.usuario={},r.signupForm.$setPristine()}}]),angular.module("reqnrule").controller("SolicitarMudancaController",["$scope","$modalInstance","$location","RequisitoService","requisito",function(o,e,r,t,a){var i=this;i.requisito=a,o.close=function(){e.close()},o.confirmar=function(){e.close()},o.cancel=function(){e.dismiss()},i.solicitarMudanca=function(){var o=t.solicitarMudanca(i.requisito.id,i.solicitacao);o.then(function(){result={tipo:"sucesso",msg:"Solicitação realizada com sucesso!"},e.close(result)},function(o){i.solicitacaoInvalida=!0})}}]),angular.module("reqnrule").controller("UpdateMembroController",["SERVER_CONFIG","$scope","$modalInstance","$location","ProjetoService","membro",function(o,e,r,t,a,i){var n=this;n.membro=i,n.novoPapel=4,n.papeis=[{valor:1,nome:"Gerente de Projeto"},{valor:2,nome:"Gerente de Requisitos"},{valor:3,nome:"Verificador"},{valor:4,nome:"Observador"}],e.close=function(){r.close()},e.cancel=function(){r.dismiss()},n.alterarMembro=function(){var o=a.alterarMembro(n.membro,n.novoPapel);o.then(function(o){result={tipo:"sucesso",msg:"Membro alterado com sucesso!"},r.close(result)},function(o){"403"==o.status?(result={tipo:"erro",msg:o.data.permissao},r.close(result)):"401"==o.status?(r.dismiss(),alert("Usuário não autorizado."),t.path("/login"),t.replace()):"500"==o.status?alert("Problema ao alterar membro. Erro interno do servidor."):"0"==o.status&&(r.dismiss(),alert("Servidor inacessível. Tente mais tarde."),t.path("/"),t.replace())})},n.excluirMembro=function(){var o=a.alterarMembro(n.membro,5);o.then(function(o){result={tipo:"sucesso",msg:"Membro excluído com sucesso!"},r.close(result)},function(o){"403"==o.status?(result={tipo:"erro",msg:o.data.permissao},r.close(result)):"401"==o.status?(r.dismiss(),alert("Usuário não autorizado."),t.path("/login"),t.replace()):"500"==o.status?alert("Problema ao excluir membro. Erro interno do servidor."):"0"==o.status&&(r.dismiss(),alert("Servidor inacessível. Tente mais tarde."),t.path("/"),t.replace())})},n.getPapel=function(){return o.PAPEL[n.membro.papel]}}]),angular.module("reqnrule").controller("UsuarioController",["AuthService","UserService","$location","$scope",function(o,e,r,t){var a=this;a.erro={},a.usuario=o.getUser(),a.alterar=function(){var o=e.alterar(a.usuario);o.then(function(o){a.alteracaoInvalida=!1,a.alteracaoValida=!0,t.usuarioForm.$setPristine()},function(o){a.erro={},a.alteracaoInvalida=!0,a.alteracaoValida=!1,"403"==o.status?(a.erro.companhia=[o.data.companhia],a.erro.nome=[o.data.nome]):"401"==o.status?(alert("Usuário não autorizado."),r.path("/login"),r.replace()):"500"==o.status?(alert("Problema ao alterar perfil de usuário. Erro interno do servidor."),a.resetAlterarForm()):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),r.path("/"),r.replace())})},a.alterarSenha=function(){e.alterarSenha(a.senhaAntiga,a.senhaNova).then(function(o){a.senhaInvalida=!1,a.senhaValida=!0,a.clearSenhaForm()},function(o){a.erro={},a.senhaInvalida=!0,a.senhaValida=!1,"400"==o.status?(a.erro.senhaAntiga=[o.data.senhaantiga],a.erro.senhaNova=[o.data.senhanova],a.clearSenhaForm()):"401"==o.status?(alert("Usuário não autorizado."),r.path("/login"),r.replace()):"500"==o.status?(alert("Problema ao alterar senha. Erro interno do servidor."),a.clearSenhaForm()):"0"==o.status&&(alert("Servidor inacessível. Tente mais tarde."),r.path("/"),r.replace())})},a.resetAlterarForm=function(){a.usuario=o.getUser(),t.usuarioForm.$setPristine()},a.clearSenhaForm=function(){a.senhaAntiga="",a.senhaNova="",t.senhaForm.$setPristine()}}]),angular.module("reqnrule").controller("VisualizarSolicitacaoController",["$scope","$modalInstance","solicitacao",function(o,e,r){var t=this;t.solicitacao=r,o.cancel=function(){e.dismiss()},t.getDataFormatada=function(o){var e=new Date(o);return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+" "+("0"+e.getDate()).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()}}]),angular.module("reqnrule").factory("AuthService",["SERVER_CONFIG","$http","$cookies","$location","$q",function(o,e,r,t,a){var i=null,n={hasUser:function(){return null==r.get("auth_token")?!1:!0},getUser:function(){return i},session:function(){var t=a.defer();return e({method:"GET",url:o.URI+"/api/auth/session",headers:{auth_token:r.get("auth_token")}}).then(function(o){i=o.data,t.resolve(i)},function(o){r.remove("auth_token"),i=null,t.reject(o)}),t.promise},login:function(t,n){var s=a.defer();return e({method:"POST",url:o.URI+"/api/auth/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){
var e=[];for(var r in o)e.push(encodeURIComponent(r)+"="+encodeURIComponent(o[r]));return e.join("&")},data:{email:t,senha:n}}).then(function(o){i=null,r.put("auth_token",o.data.auth_token),s.resolve(o)},function(o){i=null,r.remove("auth_token"),s.reject(o)}),s.promise},logout:function(){return e({method:"POST",url:o.URI+"/api/auth/logout",headers:{auth_token:r.get("auth_token")}}).then(function(o){return i=null,r.remove("auth_token"),t.path("/"),t.replace(),o},function(o){return i=null,r.remove("auth_token"),t.path("/"),t.replace(),o})}};return n}]),angular.module("reqnrule").factory("ProjetoService",["SERVER_CONFIG","$http","$cookies","$q",function(o,e,r,t){var a=[],n={},s={getProjetoSelecionado:function(){return n},encontrarProjetoPorId:function(a){var i=t.defer();return e({method:"GET",url:o.URI+"/api/projeto/encontrar/"+a,headers:{auth_token:r.get("auth_token")}}).then(function(o){n=o.data,i.resolve(n)},function(o){i.reject(o)}),i.promise},listaProjetos:function(){return a},getProjetos:function(){var i=t.defer();return e({method:"GET",url:o.URI+"/api/projeto/lista-projetos",headers:{auth_token:r.get("auth_token")}}).then(function(o){a=o.data,i.resolve(a)},function(o){a=[],i.reject(o)}),i.promise},novoProjeto:function(a){var i=t.defer();return e({method:"POST",url:o.URI+"/api/projeto/novo",headers:{auth_token:r.get("auth_token")},data:JSON.stringify(a)}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise},alterarProjeto:function(a){var i=t.defer();return e({method:"PUT",url:o.URI+"/api/projeto/alterar/"+a.id,headers:{auth_token:r.get("auth_token"),"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var e=[];for(var r in o)e.push(encodeURIComponent(r)+"="+encodeURIComponent(o[r]));return e.join("&")},data:{nome:a.nome,descricao:a.descricao}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise},deletarProjeto:function(a){var i=t.defer();return e({method:"DELETE",url:o.URI+"/api/projeto/deletar/"+a,headers:{auth_token:r.get("auth_token")}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise},getPapel:function(e,r){for(i=0;i<e.membros.length;i++)if(membro=e.membros[i],membro.usuario.id==r)return o.PAPEL[membro.papel]},alterarMembro:function(a,i){var n=t.defer();return e({method:"PUT",url:o.URI+"/api/projeto/membro/alterar/"+a.id,headers:{auth_token:r.get("auth_token"),"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var e=[];for(var r in o)e.push(encodeURIComponent(r)+"="+encodeURIComponent(o[r]));return e.join("&")},data:{papel:i}}).then(function(o){var e=o.data;s.atualizarMembros(e),n.resolve(e)},function(o){n.reject(o)}),n.promise},adicionarMembro:function(a,i,n){var u=t.defer();return e({method:"POST",url:o.URI+"/api/projeto/"+a.id+"/membro/novo",headers:{auth_token:r.get("auth_token"),"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var e=[];for(var r in o)e.push(encodeURIComponent(r)+"="+encodeURIComponent(o[r]));return e.join("&")},data:{usuario:i.id,papel:n}}).then(function(o){var e=o.data;s.atualizarMembros(e),u.resolve(e)},function(o){u.reject(o)}),u.promise},alterarDonoProjeto:function(a){var i=t.defer();return e({method:"PUT",url:o.URI+"/api/projeto/alterar-dono/"+a.id,headers:{auth_token:r.get("auth_token"),"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var e=[];for(var r in o)e.push(encodeURIComponent(r)+"="+encodeURIComponent(o[r]));return e.join("&")}}).then(function(o){s.getProjetoSelecionado().dono=a.usuario,i.resolve(o.data)},function(o){i.reject(o)}),i.promise}};return s.atualizarMembros=function(o){for(var e in n.membros)if(n.membros[e].id==o.id)return void("EXCLUIDO"==o.papel?n.membros.splice(e,1):n.membros[e]=o);n.membros.push(o)},s}]),angular.module("reqnrule").factory("RequisitoService",["SERVER_CONFIG","ProjetoService","$http","$cookies","$q",function(o,e,r,t,a){var i={adicionarRequisito:function(e,i){var n=a.defer();return r({method:"POST",url:o.URI+"/api/projeto/"+e.id+"/requisito/novo",headers:{auth_token:t.get("auth_token")},data:angular.toJson(i)}).then(function(o){n.resolve(o.data)},function(o){n.reject(o)}),n.promise},encontrarRequisitoPorId:function(e){var i=a.defer();return r({method:"GET",url:o.URI+"/api/projeto/requisito/"+e,headers:{auth_token:t.get("auth_token")}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise},solicitarMudanca:function(e,i){var n=a.defer();return r({method:"POST",url:o.URI+"/api/projeto/requisito/"+e+"/solicitar-mudanca",headers:{auth_token:t.get("auth_token"),"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var e=[];for(var r in o)e.push(encodeURIComponent(r)+"="+encodeURIComponent(o[r]));return e.join("&")},data:{solicitacao:i}}).then(function(o){n.resolve(o.data)},function(o){n.reject(o)}),n.promise},alterarRequisito:function(e){var i=a.defer();return r({method:"PUT",url:o.URI+"/api/projeto/requisito/alterar",headers:{auth_token:t.get("auth_token")},data:angular.toJson(e)}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise},deletarRequisito:function(e){var i=a.defer();return r({method:"DELETE",url:o.URI+"/api/projeto/requisito/deletar/"+e.id,headers:{auth_token:t.get("auth_token")}}).then(function(o){i.resolve()},function(o){i.reject(o)}),i.promise}};return i}]),angular.module("reqnrule").factory("UserService",["SERVER_CONFIG","$http","$cookies","$q",function(o,e,r,t){var a={signup:function(r){var a=t.defer();return e({method:"POST",url:o.URI+"/api/usuario/novo",data:JSON.stringify(r)}).then(function(o){a.resolve(o)},function(o){a.reject(o)}),a.promise},alterar:function(a){var i=t.defer();return e({method:"PUT",url:o.URI+"/api/usuario/atualizar",headers:{auth_token:r.get("auth_token")},data:JSON.stringify(a)}).then(function(o){i.resolve(o)},function(o){i.reject(o)}),i.promise},alterarSenha:function(a,i){var n=t.defer();return e({method:"PUT",url:o.URI+"/api/usuario/alterar-senha",headers:{auth_token:r.get("auth_token"),"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var e=[];for(var r in o)e.push(encodeURIComponent(r)+"="+encodeURIComponent(o[r]));return e.join("&")},data:{senhaantiga:a,senhanova:i}}).then(function(o){n.resolve(o)},function(o){n.reject(o)}),n.promise},encontrarPorEmail:function(a){var i=t.defer();return e({method:"GET",url:o.URI+"/api/usuario/encontrar-email/"+a,headers:{auth_token:r.get("auth_token")}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise}};return a}]);